<!DOCTYPE html>
<html>

<!-- <script>
    import { createClient } from '@supabase/supabase-js'

    const supabase = createClient('SUPABASE_URL', 'SUPABASE_ANON_KEY')

    // Listen for new messages
    supabase
        .channel('chat')
        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, (payload) => {
            console.log('New message:', payload.new)
            // Update UI with new message
        })
        .subscribe()

    const sendMessage = async (chatId, userId, text) => {
        const { error } = await supabase
            .from('messages')
            .insert([{ chat_id: chatId, user_id: userId, content: text }])

        if (error) console.error('Error sending message:', error)
    }

    const fetchMessages = async (chatId) => {
        const { data, error } = await supabase
            .from('messages')
            .select('*')
            .eq('chat_id', chatId)
            .order('created_at', { ascending: true })

        if (error) console.error('Error fetching messages:', error)
        return data
    }
</script> -->

<head>
    <title>Totaly non-suspicious activty going on here teacher</title>
</head>

<body>
    <h2>Chat Room</h2>
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        // 🔗 Connect to Supabase
        const supabase = createClient('https://vpbiokohfyslgudzesot.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZwYmlva29oZnlzbGd1ZHplc290Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4ODI2NDgsImV4cCI6MjA2NTQ1ODY0OH0.sQHNxJNnXe92QAf-yMmEJseWT1fblY0K3mC6NgbdwUw');

        const chatId = 1; // Change this to your chat ID
        const userId = 123; // Replace with actual user ID

        // 🚀 Real-Time Listener: Show new messages automatically
        supabase.channel('chat')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, (payload) => {
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML += `<p><b>User ${payload.new.user_id}:</b> ${payload.new.content}</p>`;
            })
            .subscribe();

        // 📨 Send Message to Supabase
        async function sendMessage() {
            const messageInput = document.getElementById("messageInput");
            const text = messageInput.value.trim();
            if (!text) return;

            const { error } = await supabase.from('messages').insert([
                { chat_id: chatId, user_id: userId, content: text }
            ]);

            if (error) console.error("Error sending message:", error);
            else messageInput.value = "";
        }

        // 🔍 Fetch Previous Messages on Page Load
        async function fetchMessages() {
            const { data, error } = await supabase.from('messages')
                .select('*').eq('chat_id', chatId)
                .order('created_at', { ascending: true });

            if (error) console.error("Error fetching messages:", error);
            else {
                const messagesDiv = document.getElementById('messages');
                data.forEach(msg => {
                    messagesDiv.innerHTML += `<p><b>User ${msg.user_id}:</b> ${msg.content}</p>`;
                });
            }
        }

        fetchMessages(); // Load previous messages
    </script>
</body>

</html>